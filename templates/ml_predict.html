<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ML Crop Prediction</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
</head>
<body class="dashboard-page">

<!-- TOP BAR -->
<div class="top-bar">
    <h2>ðŸŒ¾ Smart Crop Recommendation System</h2>
    <div class="user-info">
        <span>{{ user.email }}</span>
        <a href="{{ url_for('logout') }}">Logout</a>
    </div>
</div>

<!-- TABS -->
<div class="tabs">
    <a href="{{ url_for('dashboard') }}">Similar Crops</a>
    <a href="{{ url_for('fertilizer_page') }}">Fertilizer Used</a>
    <a class="active">ML Predict</a>
</div>

<!-- CONTENT -->
<div class="content">

    <!-- INPUT CARD -->
    <div class="card">
        <h3>ML Crop Prediction & Ranking</h3>

        <form method="POST">

            <input type="text" name="city" placeholder="City (e.g. Bengaluru)" required>

            <select name="soil_type" required>
                <option value="">Select Soil Type</option>
                <option>Red Soil</option>
                <option>Black Soil</option>
                <option>Alluvial Soil</option>
                <option>Laterite Soil</option>
            </select>

            <select name="season" required>
                <option value="">Select Season</option>
                <option>Kharif</option>
                <option>Rabi</option>
                <option>Zaid</option>
            </select>

            <select name="fertilizer_type" required>
                <option value="">Select Fertilizer</option>
                <option>Urea</option>
                <option>DAP</option>
                <option>MOP</option>
                <option>Urea + SSP + MOP</option>
            </select>

            <button type="submit">Predict & Rank</button>
        </form>
    </div>

    <!-- RESULTS -->
    {% if input_label %}
    <div class="card" style="margin-top:30px;">
        <h3>Prediction Result</h3>

        <p><strong>Predicted Crop Type:</strong> {{ input_value }}</p>

        {% if model_confidence %}
        <p><strong>Model Confidence:</strong> {{ (model_confidence * 100) | round(2) }}%</p>
        {% endif %}
    </div>
    {% endif %}

    <!-- RANKED TABLE -->
    {% if ranked_by_price %}
    <div class="card" style="margin-top:30px; width:100%;">
        <h3>Market Price Ranking ({{ city }})</h3>

        <table style="width:100%; border-collapse:collapse;">
            <tr style="background:#e8f5e9;">
                <th>Crop</th>
                <th>Min Price</th>
                <th>Modal Price</th>
                <th>Max Price</th>
                <th>Year</th>
                <th>Month</th>
            </tr>

            {% for row in ranked_by_price %}
            <tr>
                <td>{{ row.matched_crop or row.requested_crop }}</td>
                <td>{{ row.min_price or "-" }}</td>
                <td><strong>{{ row.modal_price or "-" }}</strong></td>
                <td>{{ row.max_price or "-" }}</td>
                <td>{{ row.year or "-" }}</td>
                <td>{{ row.month or "-" }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
    {% endif %}

</div>

</body>
</html>
